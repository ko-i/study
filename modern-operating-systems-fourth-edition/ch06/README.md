# 第6章 死锁

### 习题

---
#### 1. 给出一个由策略产生死锁的例子。
* 公司一想根据公司二的销售策略来指定自己的销售策略，公司二想根据公司一的销售策略来制定自己的销售策略，于是最后谁也没有制定销售策略。

---
#### 2. 学生们在机房的个人计算机上将自己要打印的文件发送给服务器，服务器会将这些文件暂存在它的硬盘上。如果服务器磁盘空间有限，那么，在什么情况下会产生死锁？这样的死锁应该怎样避免？
* 有可能在每个学生在发送文在到磁盘一半时被进程切换，导致磁盘上充斥着不完全的文件，然后每个文件都无法打印。
* 换更大的磁盘。

---
#### 3. 在前一题中，哪些资源是可抢占的，哪些资源是不可抢占的？
* 磁盘是可抢占的，打印机是不可抢占的。

---
#### 4. 在图6-1中，资源释放的顺序与获得的顺序相反，以其他的顺序释放资源能否得到同样的结果？
* 能。

---
#### 5. 一个资源死锁的发生有四个必要条件（互斥使用资源，占有和等待资源，不可抢占资源和环路等待资源）。举一个例子说明他们对于一个资源死锁发生不是充分条件。何时这些条件对一个资源死锁的发生时充分条件？
* 如果每种资源只有一个的时候，这就是成立的。

---
#### 6. 城市街道很容易遇到循环阻塞的情况，我们称之为“僵局”。其中交叉路口被汽车阻塞，这些汽车阻塞了他们后面的气车，进而又阻塞了试图进图前面路口的车辆。成世界去的所有路口都以一种循环的方式遍布被阻塞的汽车。“僵局”是一个资源死锁和同步竞争的问题。纽约市的预防算法称为“非阻塞盒子”，除非一个交叉路口的后续空间是非阻塞的，否则禁止汽车进入这个交叉路口。这是哪种预防算法？你能否提供其他预防算法来解决“僵局”问题？
* 银行家算法。
* 设置交通信号灯。

---
#### 7. 假设四辆汽车同时从四个不同的方向驶向同一个交叉路口。路口的每一个拐角处都有一个停车标志。假设交通规则要求当两辆汽车同时接近相邻的停车标志时，左边的车必须让右边的车先行。那么当四辆车同时接近停车标志是，每辆车都会让右边的车先行。这是否是一个异常的通信死锁？这是否一个资源死锁？
* 这不是通信死锁。
* 是资源死锁。

---
#### 8. 有没有可能一个资源死锁涉及一个类型的多个单位和另一个类型的一个单位？如果有可能请给出一个例子。
* 有啊，比如说有一个占着唯一一台扫描仪的进程想把扫描到的内容写入内存，但是所有内存已经被某一个想要把内存数据写入扫描仪的进程占满。

---
#### 9. 图6-3给出了资源分配图的概念，试问是否存在不合理的资源分配图，即资源分配图在结构上违反了使用资源的模型？如果存在，请给出一个例子。
* 有，比如说一个独占资源被同时分配给了多个进程。

---
#### 10. 考虑图6-4.假设在图6-4o中，C请求S而不是请求R，这是否会导致死锁？假设它同时请求S和R，情况又如何？
* 不会，只要是C所有的请求都在B之前完成，就不会产生死锁。

---
#### 11. 假设一个系统中存在一个资源死锁。举一个例子说明死锁的进程集合能够包括不在相应的资源分配图的循环链中的进程。
* 比如说循环链之外的一个进程正在请求分配一个处在死锁循环链上的资源，那这个进程就也死锁了。

---
#### 12. 为了控制流量，网络路由器A周期性的向邻居B发送消息，告诉他增加或者减少能够处理的包的数目。在某个时间点，路由器A充斥着流量，因此A向B发消息，通过制定B能够发送的数据量（A的窗口大小）为0来告诉他停止发送流量。流量高峰期过去之后，A向B发送一个新消息，通过将A的窗口大小从0增加到一个正数来高速它重新启动数据传输。但是这条消息丢失了。如前所属，两方都不会传输数据。这是哪种类型的死锁？
* 通信死锁，可以通过超时重传来解决。

---
#### 13. 鸵鸟算法中提到了填充进程表项或者其它系统表的可能。能否给出一种能够使系统管理员从这种状况下恢复系统的可能？
* 可以通过杀死对系统影响最小的进程，当然先要记录下他被杀死前的所有状态，然后等系统死锁解除后重新运行。

---
#### 14. 考虑系统的如下状态，有四个进程P1，P2，P3，P4，以及五种类型的资源...使用6.4.2接种描述的死锁检测算法来说明该系统存在一个死锁。并识别在思索中的进程。
* P1和P4死锁。

---
#### 15. 解释系统是如何从前面问题死锁中恢复的：使用（a）抢占（b）回滚（c）终止进程。
* 可以通过P1抢占一个RS1资源。
* 然后让P4回滚到之前的状态。
* 可以终止P1

---
#### 16. 假设在图6-6中，对某个i，有Cij + Rij > Ej，这意味着什么？
* 这意味着它的请求永远无法满足。

---
#### 17. 图6-8中的所有轨道都是水平或者垂直的。你能否设想一种情况，使得同样存在卸轨迹的方法？
* 两个CPU同时运行这两个进程。

---
#### 18. 图6-8所示的资源轨迹模式是否可用来说明三个资源的死锁问题？如果可以，他是怎么说明的，如果不可以，请解释为什么？
* 可以啊，再加一个资源的使用时间就行。

---
#### 19. 理论上，资源轨迹图可以用于避免思索。通过合理的调度，操作系统可以避免进入不安全区域。请列举一个在实际运用这种方法时会带了的问题。
* 操作系统无法明确得知资源的未来的使用计划。

---
#### 20. 一个系统是否可能处于即非死锁也不安全的状态？如果可以，请举出例子；如果不可以，请证明所有状态只能处于死锁或安全的状态之一。
* 如果可以通过合理调度避免死锁，那这种状态就是处在不安全但非死锁的状态中。

---
#### 21. 仔细考虑图6-11b，如果D在多请求一个单位，会导致安全状态还是不安全状态？如果换成C提出同样的请求，情形会怎么样？
* 会导致安全状态。
* 会导致不安全状态。

---
#### 22. 某一操作系统有两个进程和三个相同的资源。每个进程最多需要两个资源。这种情况下有没有可能发生死锁，为什么。
* 不可能，因为没有资源竞争的条件。

---
#### 23. 重新考虑上一题，假设现在共有p个进程，每个进程最多需要m个资源，并且有r个资源可用。这种情况下有没有可能发生死锁？
* 如果p > r 或 m > r会死锁。
* r > p * (m - 1) + 1可以保证不会死锁。

---
#### 24. 假设图6-12中的进程A请求最后一台磁带机，这一操作会引起死锁吗？
* 不会。

---
#### 25. 银行家算法在一个有m个资源类型和n个进程的系统中运行。当m和n都很大时，未检测状态是否安全而进行的操作次数正比于m ^ a和n ^ b，a和b的值分别是多少？
* 1 2

---
#### 26. 一个系统有4个进程和5个可分配资源。当前分配和最大需求如下：若保持该状态是安全状态，x的最小值是多少？
* 2

---
#### 27. 一个消除环路等待的方法是用规则约定一个进程在任意时刻只能得到一个资源。请举例说明在很多情况下这个限制是不可接受的。
* 比如说在需要从内存中读入数据到蓝光刻录机，这就一定要同时需要两个设备。

---
#### 28. 两个进程A和B，每个进程都需要数据库中的3个记录，1、2、3.如果A和B都以1、2、3的次序请求，将不会发生死锁。但是如果B以3、2、1的次序请求，那么死锁就有可能发生，对于这三种资源，每个进程共有3！种次序请求，这些组合中有多大的可能可以保证不发生死锁？
* 3 / (6 * 6 * 6) 

---
#### 29. 一个使用信箱的分布式系统有两条IPC原语：send和receice。receive原语用于指定从哪个进程接收消息，并且如果指定的进程没有可用的消息，即使其他进程正在写消息，该进程也会等待。进程不存在共享资源，但是由于其他原因，进程需要经常通信。死锁有可能发生吗？请讨论这个问题。
* A向B发送消息等待回复，B向C放松消息等待回复，C向A发消息等待回复。

---
#### 30. 在一个电子资金转账系统中，有很多相同的进程按如下方式工作：每个进程读取一行输入，该输入给出一定数目的款项、贷方账户，解放账户。然后该进程锁定两个账户，传送这比钱，完成后释放锁。由于很多进程并行运行，所以存在这样的危险，锁定x会无法锁定y，因为y已被一个正在等待x的进程锁定。设计一个方案来避免死锁。保证在没有完成事务处理前不要释放该账户记录。（换句话说，在锁定一个账户时，如果发现另一个账户不能被锁定就立即释放这个已锁定的账户）
* 按照账户编号的大小顺序来加锁。

---
#### 31. 一种预防思索的方法是去除占有和等待条件。在本书中，假设在请求一个新的资源以前，进程必须释放所有它已经占有的资源（假设这是可能的）。然而，这种做法会引入这样的危险性：竞争的进程得到了新的资源却丢失了原有的资源。请给出这一方法的改进。
* 可以再请求新资源无法得到时才释放所有已获得的资源。

---
#### 32. 计算机系的学生想到了下面这个消除死锁的方法。当某一进程请求一个资源时，规定一个时间限制。如果进程由于得不到需要的资源而被阻塞，定时器就会开始运行。当超过时间限制后，进程就会被释放掉，并且允许该进程重新运行。如果你是教授，你会给这样的学生多少分？为什么？
* 这个方案是可行的，但是还会有死锁的可能，就是两个进程一同释放再一同请求不相同的资源后请求对方获得的资源。没有从根本上解决死锁。

---
#### 33. 内存单元被交换区和虚拟内存系统抢占，处理器在分时环境中被强占。你认为这些抢占方法是为了处理资源死锁还是有其它的目的？他们的开销是多大？
* 这个是公平性的原因吧。开销就是调度处理的开销。中断处理，上下文切换什么的。

---
#### 34. 解释死锁，活锁和饥饿的区别。
* 死锁是某以系统中所有进程被阻塞停止活动。活锁中进程没有被阻塞。饥饿是因为特殊的策略机制导致有些进程的需求无法被满足，被满足的可能性很小，不像死锁是永远不会被满足。死锁会触发所有进程的饥饿状态。

---
#### 35. 假设两个进程发出查找命令来改变访问磁盘的机制并启用读命令。每个进程在执行读命令之前被中断，并且发现另一个进程已经移动了磁盘。他们都重新发出查找命令，但是又同时被对方中断。这个序列不断地重复。这是一个资源死锁还是活锁？你推荐用什么算法来解决这个异常？
* 活锁，因为不存在多个资源竞争。
* 用二进制指数退避算法。

---
#### 36. 局域网中使用一种叫做CSMA/CD的媒体访问方法。在这...
* 这是一个活锁。
* 使用二进制指数退避算法。
* 会。

---
#### 37. 一个程序在合作和竞争机制的顺序上存在错误...
* 这是通信死锁。
* 通过程序员对过程的严格控制可以避免。

---
#### 38. ...和...要离婚...
* 因为他们有可能会无休止的同时请求狗，得不到后再释放，或者一个请求狗另一个请求狗窝，然后死锁，一直循环下去。