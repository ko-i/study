# 第4章 文件系统

### 习题

---
#### 1. 给出文件/etc/passwd的五种不同的路径名。（提示，考虑目录项“.”“..”）
* /etc/./passwd
* /etc/../etc/passwd
* /etc/../etc/../etc/passwd
* /./etc/passwd
* /././etc/passwd

---
#### 2. 在Windows中，当用户双击资源管理器中列出的一个文件时，就会运行一个程序，并以这个文件作为参数。操作系统需要知道运行的是哪个程序，请给出两种不同的方法。
* 可以通过扩展名来识别。
* 可以通过用户指定。
* 可以通过查看是哪个个程序创建的。

---
#### 3. 在早期的UNIX系统中，可执行文件（a.out）以一个特定的魔数而不是一个随机选取的数字开头。这些文件的开头是一个header，随后是文本段和数据段。为什么可执行文件要选取一个特定的数字，而其他类型的文件会多少有些随机的选择魔数开头？
* 为了避免执行header。

---
#### 4. 在UNIX中open系统调用绝对需要吗？如果没有会产生什么后果？
* 也不是绝对需要，如果没有的话那只是每次读写操作都需要从磁盘上查找文件属性信息，效率比较低，但也不是不行。

---
#### 5. 在支持顺序文件的系统中总有一个文件回绕操作，支持随机存取文件的系统是否也需要？
* 不需要。

---
#### 6. 某一些操作系统提供系统调用rename给文件重命名，同样也可以通过吧文件复制到新文件并删除源文件而实现文件重命名。请问这两中方法有何不同？
* 第二中需要大量的读写操作。还会改变源文件的相关时间信息。并且如果磁盘剩余空间比想要修改的文件小时，改名会失败。

---
#### 7. 在有些系统中有可能把部分文件映射进内存中。如此一来系统应该施加什么限制？这部分映射如何实现？
* 这不就是高速缓存么，就像分页那样实现。

---
#### 8. 有一个简单的操作系统只支持单一目录结构，但是允许该目录中有任意多个文件，且带有任意长度的名字。这样可以层次文件系统吗？如何进行？
* 就像域名系统那种，以特殊符号分割就行。

---
#### 9. 在UNIX和Windows中，通过使用一个特殊的系统调用把文件的“当前位置”指针移动到指定字节，从而实现了随机访问。请提出一个不使用该系统调用完成随机存取的替代方案。
* 不要用文件指针，把文件存到可以随机访问的结构中。

---
#### 10. 考虑4-8中的目录树，如果当前工作目录是/usr/jim，则相对路径名为../ast/x的文件的绝对路径名是什么？
* /usr/ast/x

---
#### 11. 正如书中所提到的，文件的连续分配会导致磁盘碎片，因为当一个文件的长度不等于块的整数倍时，文件中的最后一个磁盘块中的空间会浪费掉。请问这是内碎片还是外碎片？并将它与先前一章的有关讨论进行比较。
* 在块内的碎片所以是内部碎片，如果是多个块形成的空洞那个是外部碎片。
* 这个跟之前的分段类似。

---
#### 12. 描述一个损坏的数据块对以下三种形式的文件的影响：（a）连续的（b）链表的（c）索引的
* 如果连续的数据块中某个数据块损坏了，那么其它块还是可读取的。
* 对链表的影响是在它之后的块都不可读取。
* 对索引的影响也是只有他本身不可读取。

---
#### 13. 一种在磁盘上连续分配并且可以避免空洞的方法是，每次删除一个文件后就紧缩一下磁盘。对于所有的文件都是连续的，复制文件时需要寻道时间和旋转延迟以便读取文件，然后全速传送。在写回文件时要做同样的工作。假设寻道时间为5ms，旋转延迟为4ms，传送效率为8MB/s，而文件平均长度是8KB，把一个文件读入内存并写回到磁盘上的一个新位置需要多长时间？运用这些数字，计算紧缩16GB硬盘的一半需要多长时间？
* 19ms
* 19000s

---
#### 14. 基于前一个问题的答案，紧缩磁盘有什么作用吗？
* 可以提高磁盘的利用率。

---
#### 15. 某些数字消费设备需要存储数据，比如存放文件等。给出一个现代设备的名字，该设备需要文件存储，并且适合连续空间分配。
* 数码照相机

---
#### 16. 考虑图4-13中的i节点。如果它含有用4个字节表示的10个直接地址，而且所有的磁盘块大小是1024KB，那么文件最大可能是多大？
* 256G

---
#### 17. 一个班的学生信息存储在一个文件中，这些记录可以被随意访问和更新。假设每个学生记录大小都相同，那么在连续的、链表的和表格/索引的这三种方式中，哪个方式最合适？
* 那肯定是索引啊。

---
#### 18. 考虑一个大小始终在4KB和4MB之间变化的文件，连续的，链表的和表格、索引的这三种分配方式中，哪个最合适？
* 链表和表格都可以。

---
#### 19. 有建议说，把段文件的数据存在i节点内会提高效率并节省磁盘空间。对于4-13中的i节点，在i节点内可以存放多少字节的数据？
* 9K。

---
#### 20. 两个计算机科学系的学生正在讨论i节点。认为存储器容量越来越大，价格越来越便宜，所以当打开文件时，直接取i节点的副本，放到内存i节点表中，建立一个新i节点将更简单，更快，没必要搜索整个i节点来判断它是都已经存在。另一个则不同意这一观点。他们两个人谁对？
* 写回的时候多个指向相同块的i节点会冲突。

---
#### 21. 说明硬链接由于符号链接的一个优点，并说明符号链接优于硬链接的一个优点。
* 创建硬链接比软连接的内存开销小，删除一个硬链接不会影响其他有此硬链接的节点。
* 软连接可以指向任何地方，不同的文件系统也可以指。

---
#### 22. 分别阐释硬链接和软连接与i节点分配方式的区别。
* 硬链接会将所有目录条目指向一个i节点。
* 软连接会为目录条目创建一个新的i节点，但这个i节点指向原始文件。

---
#### 23. 考虑一个块大小为4KB、使用自由列表的4TB的磁盘，多少个块地址可以被存在一个块中？
* 1024个

---
#### 24. 空闲磁盘空间可用空闲块表或位图来跟踪。假设磁盘地址需要D位，一个磁盘有B个块，其中有F个空闲。在什么条件下，空闲块表采用的空间少于位图？设D为16位，请计算空闲磁盘空间的百分比。
* DF < B时可以
* 1 / 16

---
#### 25. 一个空闲块位图开始时和磁盘分区首次初始化类似，比如：1000 0000 0000 0000（首块被根目录使用），系统总是从最小编号的盘块开始寻找空闲块，所以在右6块的文件A写入之后，改位图为1111 1110 0000 0000。请说明在完成如下每一个附加动作之后位图的状态：
* 写入有5块的文件B  1111 1111 1111 0000
* 删除文件A        1000 0001 1111 0000
* 写入有八块的文件C 1111 1111 1111 1100
* 删除文件B        1111 1110 0000 1100

---
#### 26. 如果因为系统崩溃而使存放空闲磁盘块信息的空闲块表或位图完全丢失，会发生什么情况？有什么办法从这个灾难中恢复吗？分别就UNIX和FAT-16文件系统讨论你的答案。
* UNIX可以遍历文件系统中的目录条目，扫描所有的节点。
* FAT文件系统中没有空闲块表或位图。

---
#### 27. Oliver Owl在大学计算机中心的工作是更换用于通宵数据备份的磁带，在等待每盘磁带完成的同时，他在写一篇论文，证明莎士比亚戏剧是由外星访客写的。由于仅有一个系统，所以只能在正在做备份的系统上运行文本编辑程序，这样的安排有什么问题吗？
* 没什么问题，写完了记得保存就行。不然因为备份的原因可能会中途保存它写了一半的内容。

---
#### 28. 在教材中我们详细讨论了增量转储。在Windows中很容易说明合适要转储一个文件，因为每个文件都有一个存档位。在UNIX中没有这个位，那么UNIX备份程序怎样知道那个文件需要转储？
* 设置一个最后转储时间，然后通过比较最后修改时间和最后转储时间。

---
#### 29. 假设图4-25中的文件21自上次转储之后没有修改，在什么情况下图4-26中的四张位图会不同？
* 这什么鬼翻译。ab没有21不会变，c不变，d也没有21

---
#### 30. 有人建议每个UNIX文件的第一部分最好和其i节点放在同一个磁盘块中，这样做有什么好处？
* 可以有效的管理小文件。

---
#### 31. 考虑图4-27。对某个特殊的块号，计数器的值在两个表中有没有可能都是数值2？这个问题如何纠正？
* 一切皆有可能。
* 先把空闲的2删了，然后再像处理2个使用时一样。

---
#### 32. 文件系统的性能与高速缓存的命中率有很大的关系（即在高速缓存中找到所需块的概率）。从高速缓存中读取数据需要1ms，而从磁盘上读取需要40ms，若命中率为h，给出读取数据所需平均时间的计算公式。并画出曲线。
* T = 1 * h + 40 * (1 - h)

---
#### 33. 对于与计算机相连接的一个外部USB硬盘驱动器，通写高速缓存和块高速缓存哪个更合适？
* 通写，只要不是闪存盘，都可以通写。

---
#### 34. 考虑一个将学生记录存放在文件中的应用，它以学生ID作为输入，随后读入，更新和写相应的学生记录。这个过程重复进行直到应用结束。块预读技术在这里适用吗？
* 有可能适用，一般情况都会顺序一个个的更新信息。

---
#### 35. 考虑一个有10个数据块的磁盘，这些数据块从14到23。有两个文件在这个磁盘上：f1和f2.这个目录结构显示f1和f2的第一个数据块分别为22和16.给定FAT表项如下，哪些数据块分配给f1和f2？
* f1：22 19 15 17 21 
* f2：23 14 18 20

---
#### 36. 考虑图4-21背后的思想，目前磁盘平均寻道时间为8ms，旋转速率为15000rpm，每道为262144字节。对大小各为1KB，2KB，4KB的磁盘块，传送速率各是多少？
* 1KB 100MB/s
* 2KB 200MB/s
* 4KB 400MB/s

---
#### 37. 某个文件系统使用2KB的磁盘块，而中间文件大小值为1KB。如果所有文件都是整好1KB大，那么浪费掉的磁盘空间比例是多少？你认为一个真正的文件系统所浪费的空间比这是数值大还是小？
* 0.5
* 小

---
#### 38. 给定磁盘块大小为4KB，块指针地址值为4字节，使用10个直接地址和一个间接块可以访问的最大文件大小是多少字节？
* 4MB

---
#### 39. MS-DOS中的文件必须在内存的FAT-16表中竞争空间。如果某个文件使用了k个表项，其它任何文件就不能使用这k个表项，这样会对所有文件的总长度带来什么限制？
* 文件总长度不能大于磁盘的总容量。

---
#### 40. 一个UNIX系统使用4KB磁盘块和4字节磁盘地址。如果每个i节点中有10个直接表项和一个间接表块、一个二次间接表块，一个三次间接表块，那这个文件最大能有多大？
* 2 ^ 30 * 4KB

---
#### 41. 对于文件/usr/ast/cousers/os/handout.t，若要获取其i节点需要多少个磁盘操作？假设其根目录的i节点在内存中，其他路径都不在内存中。并假设所有的目录都在一个磁盘块中。
* 10次

---
#### 42. 在许多UNIX系统中，i节点存放在磁盘的开始处。一种替代方案是，在文件创建时分配i节点，并把i节点放在该文件首个磁盘块的开始处，请讨论这个方案的优点。
* 优点是每次访问i节点和数据块的时间变少。因为磁盘臂移动较少。
* 不用预留i节点的空间。
* i节点的数量不在有限制。

