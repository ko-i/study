# 第5章 输入/输出

### 习题

---
#### 1. 芯片技术的发展已经使得将整个控制器包括所有总线访问逻辑放在一个便宜的芯片上成为可能。这对于图1-6的模型具有什么影响？
* 芯片可以用更高效的方式来调度对其他设备的访问。不用占用总线也可以更快的访问多个外部设备。

---
#### 2. 已知图5-1列出的速度，是否可能以全速从一台扫描仪扫描文档并通过802.11g网络对其进行传输？请解释你的答案。
* 可以啊。网络的传输速度比扫描仪快多了。

---
#### 3. 图5-3b显示了即使在存在单独的总线用于内存和用于I/O设备的情况下使用内存映射I/O的一种方法，也就是说，首先尝试内存总线，如果失败则尝试I/O总线。一名聪明的计算机科学专业的学生想出了以个改进办法：并行地尝试两个总线，以加快访问I/O设备的过程。你认为这个想法如何？
* 那样一次产生两个信号，如果这两条线都能到达，那这个I/O设备将陆续收到两个相同的信号，可能有冗余。
* 内存总线较快的情况下，I/O总线会成为拖累。因为CPU总是要等待I/O总线完成。

---
#### 4. 请解释超标量体系结构是如何权衡精确中断与非精确中断的？
* 为了向后兼容老设备而采用精确中断。CPU要保证在中断发生时这一点上正在运行的指令全部完成而不允许这一点之后的指令对系统产生重要影响。

---
#### 5. 一个DMA控制器具有五个通道。控制器最快可以以每40ns请求一个32bit的数据，请求响应时间也是40ns。请问在这种情形下，总线传输速度要多快才不会成为传输瓶颈？
* 250MB/s

---
#### 6. 假设一个系统使用DMA将数据从磁盘控制器传送到内存。进一步假设平均花费t1ns获得总线，并且花费t2ns在总线上传输一个字（t1 >> t2）。在CPU对DMA控制器进行编程之后，如果（a）采用一次一字模式（b）采用突发模式，从磁盘控制器到内存传送1000个字需要多长时间？假设向磁盘控制器发送命令需要获取总线以传输一个字，并且应答传输也需要获取总线以传输一个字。
* 1000* (t1 + t2 + t1 + t2 + t1 + t2)
* t1 + 1000 * t2 + t1 + t2 + t1 + t2

---
#### 7. 一些DMA控制器采用这样的模型：对每个要传输的字，首先让设备驱动传输数据给DMA控制器，然后再第二次发起总线请求将数据写入内存。如何使用这种模型进行内存到内存的赋值？这种模式与使用CPU进行内存赋值的方式相比具有哪些优点和缺点？
* DMA对内存发起读取请求，在把读取到的数据写回到内存上。
* 优点是可以解放CPU，让CPU不必吧心思放在等待IO上。
* 缺点是相较于使用CPU来说会更慢。

---
#### 8. 假设一台计算机能够在5ns内读或者写一个内存字，并且假设当中断发生时，所有32位寄存器连同程序计数器和PSW被压入堆栈。该计算机每秒能够处理的中断的最大数目是多少？
* 一共要取34个字。将这34个字写入内存和读出内存需要340ns，1s就能处理：大概290万次中断。

---
#### 9. CPU体系结构设计师知道操作系统开发者痛恨非精确中断。满足OS开发者的一种方法是当得到一个中断信号通知时，让CPU停止发射指令，但是允许当前CPU正在执行的指令完成，然后强制中断。这一方案是否有缺点？请解释你的答案。
* 有可能有指令不按顺序执行的情况，这样等待它执行完还是不精确。

---
#### 10. 在图5-9b中，中断直到下一个字符输出到打印机之后才得到应答。中断在中断服务程序开始时立刻得到应答是否同样可行？如果是，请给出想本书中那样在中断服务程序结束时应答中断的一个理由，如果不是，为什么？
* 我觉得可以，打印机可以在应答中断之后打印，然后就能很快收到下一个字。缺点是有可能打印速度跟不上数据传输速度。

---
#### 11. 一台计算机具有如图1-7a所示的三级流水线。在每一个时钟周期，一条新的指令从PC所指向的内存地址中取出并放入流水线，同时PC值增加。每条指令恰好占据一个内存字。已经在流水线中的每个指令每个时钟周期前进一级。当中断发生时，当前PC压入堆栈，并且将PC设置为中断处理程序的地址。然后，流水线右移一级并且中断处理程序的第一条指令被取入流水线，该机器具有精确中断吗？请解释你的答案。
* 具有，因为在中断发生前的指令都可以再中断处理程序的指令发生前执行完。

---
#### 12. 一个典型的文本打印页面包含50行，每行80个字符。设想某一台打印机每分钟可以打印6个页面，并且将字符写到打印机输出寄存器的时间很短以至于可以忽略。如果打印每一个字符要请求一次中断，而进行中断服务要花费总计50us的时间，那么使用中断驱动的I/O来运行该打印机有没有意义？
* 1s400次中断一共是400 * 50 = 20000us = 20ms，1000ms内只用20ms还是有意义的。

---
#### 13. 请解释OS如何帮助安装新的驱动程序而无需重新编译OS？
* 把设备看成文件，添加一个设备就是创建一个文件，然后使用该文件就行。

---
#### 14. 以下各项工作是在四个I/O软件层的哪一层完成的？（a）为一个磁盘读操作计算磁道、扇区、磁头。（b）向设备寄存器写命令。（c）检查用户是否允许使用设备。（d）将二进制整数转换为ASCII码以便打印。
* 这个是在磁盘控制器（设备驱动程序）中完成的。
* 这个也是在设备驱动程序中完成的。
* 这个是在设备无关的软件层。
* 用户应用层。

---
#### 15. 一个局域网以如下方式使用：用户发出一个系统调用，请求将数据包写在网上，然后操作系统将数据...
* 一共4次复制 4 * 1024 * 1us = 4.096ms
* 一次传送 1024 * 8 / 10 * 10^6s =  0.8ms
* 一共2次中断 2ms
* 总归大概7ms

---
#### 16. 为什么打印机的输出文件在打印前通常假脱机输出在磁盘上？
* 骗用户进程。

---
#### 17. 一个7200rpm的磁盘寻道时间为1ms，该磁盘相邻柱面起始位置偏移角度是多少？磁盘每个磁道包含200个扇区，每个扇区大小为512B。
* 偏移24个扇区，24Pi / 100度

---
#### 18. 一个磁盘的转速为7200rpm，一个柱面上有500个扇区，每个扇区大小为512B。读入一个扇区需要多长时间？
* 1 / 60000 s

---
#### 19. 计算上题所述磁盘的最大数据传输率。
* 30MB/s

---
#### 20. 3级RAID只使用1个奇偶驱动器就能够纠正一位错误。那么2级RAID的意义是什么？毕竟2级RAID也只能够纠正1位错误而且需要更多的驱动器。
* RAID2可以再写入数据时纠正驱动器的写入差错，而3级只能恢复崩溃导致的差错，它检测不出来写入时的差错。

---
#### 21. 如果两个或更多的驱动器在很短的时间内崩溃，那么RAID就可能失效。假设在给定的一个小时内一个驱动器崩溃的概率是p，那么在给定的一小时内具有k个驱动器的RAID失效的概率是多少？
* p^k

---
#### 22. 从读性能，写性能，空间开销以及可靠性方面对0级到5级RAID进行比较。
* 主要区分在空间开销上。

---
#### 23. 1ZB等于多少PB？
* 1MPB

---
#### 24. 为什么光存储设备天生的比磁存储设备更具有更高的数据密度？注意：本题需要某些高中物理以及磁场是如何产生的知识。
* 光的影响范围比磁场要小吧。

---
#### 25. 光盘和磁盘的优点和缺点各是什么？
* 光盘存储密度大，但是只能写一次，易被划伤损坏。
* 磁盘可以多次读写，但存储密度小。小他也能在牺牲体积的情况下做到很高的存储容量。

---
#### 26. 如果一个磁盘控制器没有内部缓冲，一旦从磁盘上接收到字节就将他们写到内存中，那么交错编号还有用吗？请讨论你的答案。
* 蛤，交错编号不就是为了这个需求产生的吗。

---
#### 27. 如果一个磁盘是双交错编号的，那么该磁盘是否还需要柱面斜进以避免在进行磁道到磁道的寻道时间错过数据？请讨论。
* 也需要吧，那得看寻道时间够不够小，能在2个扇区的功夫内换道那就不用。

---
#### 28. 考虑一个包含16个磁头和400个柱面的磁盘，该磁盘分成4个100柱面的区域，不同的区域分别包含160个，200个，240个和280个扇区。假设每个扇区包含512个字节，相邻柱面间的平均寻道时间为1ms，并且磁盘转速为7200rpm。计算磁盘容量，最优磁道斜进以及最大数据传输率。
* 一共16 * 100 * （160 + 200 + 240 + 280）* 512B = 104GB
* 最优斜进略。
* 最大数据传输率：280 * 0.5KB * 120 = 16.8GB/s

---
#### 29. 一个磁盘制造商拥有两种5.25英寸的磁盘，每种磁盘都有10000个柱面。新磁盘的线性记录密度是老磁盘的两倍。在较新的驱动器上哪个磁盘的特性更好？哪个无变化？新的是否具有什么劣势？
* 新盘的读取速率和容量是老磁盘的两倍。
* 寻道时间相同。

---
#### 30. 一个计算机制造商决定重新设计奔腾硬盘的分区表以供四个以上的分区。这一变化有什么后果？
* 可能操作系统会失效。但可以重新设置操作系统。

---
#### 31. ...
* 852ms
* 276ms
* 408ms

---
#### 32. 调度磁盘请求的电梯算法的一个微小更改是总是沿相同的方向扫描。在什么方面这一更改的算法优于电梯算法？
* 在读取数据请求集中在某一个边缘时，另一边缘有少量数据请求时。
* 在磁头回归初始位置很快时。

---
#### 33. ...
* 可能他这个随机的顺序跟电梯算法的排布差不多。
* 没错销售员撒谎了。

---
#### 34. 在讨论使用非易失性RAM的稳定的存储器时，掩饰了如下要点：如果稳定写完成但是在操作系统能够将无效的块编号写入非易失性RAM之前发生了崩溃，那么会有什么结果？这一竞争条件会毁灭稳定的存储器的抽象概念吗？请解释你的答案。
* 不会啊，写都写完了崩溃就崩溃了呗。

---
#### 35. 在关于稳定存储器的讨论中，证明了如果在写过程发生了CPU崩溃，磁盘可以恢复到一个一致的状态（写操作或者已经完成，或者没有发生）。如果恢复过程中CPU再次崩溃，这一特性是否还保持？请解释你的答案。
* 会，本身恢复过程也可以作为一次稳定些，只要最后发现两个存储内容不一致，就选用前一个的。禁止套娃。

---
#### 36. 在关于稳定存储器的讨论中，一个关键假设是当CPU崩溃时，会导致一个扇区产生错误的ECC。如果这个假设不成立的话。图5-27所示的5个故障恢复场景会出现什么问题吗？
* 那么会导致认为a写成功了，这时候会把b的内容同步成a的错误内容。

---
#### 37. 某计算机上的时钟中断处理程序每一时钟滴答需要2ms（包括进程切换的开销）时钟以60Hz的频率运行，那么CPU用于时钟处理的时间比例是多少？
* 2 / (1000 / 60) = 0.12

---
#### 38. 一台计算机以方波模式使用一个可编程时钟。如果使用500MHz的晶体，为了达到如下时钟分别率，存储寄存器的值应该是多少？（a）1ms（b）100us
* 500MHz 是一秒500000000下
* 所以1ms就是  500000次
* 1us就是     500次

---
#### 39. ...
* 当前时间：5000 时钟头 -> 8 -> 12 -> 15 -> 29 -> 37
* 当前时间：5005 时钟头 -> 3 -> 7 -> 10 -> 24 -> 32
* 当前时间：5013 时钟头 -> 4 -> 7 -> 21 -> 29
* 当前时间：5023 时钟头 -> 11 -> 19 -> 25

---
#### 40. 许多UNIX版本使用一个32位无符号整数作为从时间原点计算的描述来跟踪时间。这些系统会在什么时候溢出？你认为这样的事情会实际发生吗？
* 2106年2月
* 会吧，说不定会有人把它的老电脑保护的很好并且还在遗嘱中嘱咐他儿子到时候找保险公司赔钱。

---
#### 41. ...
* 每秒显示1250行

---
#### 42. 接收到一个DEL（SIGINT）字符之后，显示驱动程序将丢弃当前排队等候显示的所有输出，为什么？
* 那不然呢，还要用户输多少次DEL。

---
#### 43. 一个用户在终端上给文本编辑器发出一个命令要求删除第5行的第7-12个字符（包含第12个）。假设命令发出时光标并不在第5行，请问编辑器要完成这项工作需要发出怎样的ANSI转义序列？
* ESC[5;7H ESC[6P

---
#### 44. 计算机系统的设计人员期望鼠标的最大速率是20cm/s。如果一个鼠标步是0.1mm，并且每个鼠标消息3个字节，假设每个鼠标步都是单独报告的，那么鼠标的最大数据传输率是多少？
* 6000B/s

---
#### 45. 基本的加性颜色是红色，绿色和蓝色，这意味着任何颜色都可以通过这些颜色的线性叠加而构造出来。某人拥有一张不能使用全24位颜色表示的彩色照片，这可能吗？
* 那怎么不可能，他用48位的颜色的照片。

---
#### 46. 将字符放置在位图模式的屏幕上，一种方法是使用bitblt从一个字体表复制位图。假设一种特殊的字体使用16x24像素的字符，并且采用RGB真彩色。（a）每个字符占用多少字体表空间？（b）如果复制一个字节花费100ns，那么到屏幕输出率是每秒多少个字符？
* 1152字节。
* 大约10000个字符。

---
#### 47. 假设复制一个字节花费10ns，那么对于80字符x25行文本模式的内存映射的屏幕，完全重写屏幕要花费多长时间？采用24位彩色的1024x768像素的图形屏幕会怎样？
* 20us
* 188ms

---
#### 48. 在图5-36中存在一个窗口类需要调用RegisterClass进行注册，在图5-34中对应的X窗口代码中，并不存在这样的调用或与此相似的任何调用。为什么？
* 因为X窗口处在比较底层，不需要通过操作系统提供的接口调用。

---
#### 49. 在课文中我们给出了一个如何在屏幕上画一个矩形的例子。是否存在对第一个参数hdc的实际需要？如果存在，是什么？毕竟，矩形的坐标作为参数显示的指明了。
* 需要指定是哪个窗口画它。

---
#### 50. 一台瘦客户端用于显示一个网页，该网页包含一个动画卡通，卡通大小为400x160像素，以每秒10帧的速度播放。显示该卡通会消耗100Mb/s快速以太网带宽的多大部分？
* 400 * 160 * 24 * 10 * 8 / 100000000 = 512 / 625

---
#### 51. 在一次测试中，一个瘦客户机系统被观测到对于1Mb/s的网络工作良好。在多用户的情形中会有问题吗？
* 看用没用组播技术。

---
#### 52. 列举出瘦客户机的两个缺点和两个优点。
* 瘦客户机减轻了用户购买硬件和维护硬件的压力。
* 很多用户的pc其实并没有得到充分利用。
* 对网络有要求，如果我网络状态不好那就完了。
* 如果数据中心炸了那就完了。

---
#### 53. 如果一个CPU的最大电压V被消减到V/n，那么他的功率消耗将下降到其原始值的1/n^2，并且它的时钟速度下降到其原始值的1/n。假设一个用户已每秒1个字符的速度键入字符，处理每个字符所需要的CPU时间为100ms，n的最优化值是多少？与不削减电压相比，以百分比表示相应的能量节约了多少？假设空闲的CPU完全不消耗能量。
* 10
* 99%

---
#### 54. 一台笔记本电脑被设置成最大地利用功率节省特性，包括在一段时间不活动之后关闭显示器和硬盘。一个用户又是在文本模式下运行UNIX程序，而在其他时间使用X窗口系统。他惊讶的发现当他使用仅限文本模式的程序是，电池的寿命相当长。为什么。
* 不用渲染图像就很省电啊。

