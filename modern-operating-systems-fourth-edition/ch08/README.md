# 第8章 多处理机系统

### 习题

---
#### 1. 可以把USENET新闻组系统和SETI@home项目看做分布式系统吗？
* 可以，他们属于c

---
#### 2. 如果一个多处理器中的三个CPU在同一时刻试图访问内存中的一个字，会发生什么？
* 看系统是如何设计的，第一个访问的CPU会给内存中的这个字上锁，只有一个会成功，具体哪一个不知道。

---
#### 3. 如果CPU在每条指令都发出一个内存访问请求，而且计算机的运行速度是200MIPS，那么多少个CPU会使1个400MHz的总线饱和？假设对内存中的访问需要一个总线周期。如果在该系统中使用缓存技术，且缓存命中率达到90%，有需要多少CPU？最后，如果要使32个CPU共享该总线而不使其过载，需要多高的命中率？
* 2个就饱和
* 20个
* 15 / 16

---
#### 4. 在图8-5的omega网络中，假设在交换网络2A和交换网络3B之间的连线断了。那么那些节点之间的联系被切断了？
* CPU 000 010 100 110 和存储器010 011被切断。

---
#### 5. 在图8-7的模型中，信号是如何处理的？
* 每个CPU独立管理自己的信号。

---
#### 6. 当如图8-8所示模型的系统调用发生时，必须要在陷入内核时立即解决一个不会再图8-7的模型中发生的问题。这个问题的本质是什么？如何解决？
* 所有有关CPU的系统调用都要发送到主CPU让它来处理。主CPU的速度可能成为瓶颈。让主CPU的速率更大。

---
#### 7. 使用纯read重写图2-22中的enter_region代码，用以减少由TSL指令所引起的颠簸。
```
enter_region:
TST LOCK
JNE ENTERREGION
TSL REGISTER,LOCK
CMP REGISTER,#0
JNE ENTERREGION
RET 
```

---
#### 8. 多核CPU开始在普通的桌面机和笔记本电脑上出现，拥有数十乃至数百核的桌面机也为期不远了。利用这些激素啊能力的一个可能的方式是将标准的桌面应用程序并行化，例如文字处理或者Web浏览器；另一个可能的方式是将操作系统提供的服务和常用的库服务并行化。你认为哪一种更有前途？为什么？
* 我认为将操作系统提供的服务和常用库的服务并行化更有前途，因为这一种并行编程离底层多核更近，会更容易控制。如果更上层提供并行将更多的导致编程复杂性。

---
#### 9. 为了避免竞争，在SMP操作系统代码段中的临界区真的有必要吗？或者数据结构中的互斥信号量也可以完成这项工作吗？
* 我觉得可以。但是如果有操作不涉及操作数据结构的话，是否让它做这个多余的操作可以根据统计规律来权衡。

---
#### 10. 在多处理器同步使用TSL指令时，如果持有的CPU和请求锁的CPU都需要使用这个拥有互斥信号量的高速缓冲块，那么这个拥有互斥信号量的...
* 16 * 2 / 50

---
#### 11. 教材中曾经建议在使用RSL轮询锁之间使用二进制指数补偿算法。也建议过在轮训之间使用最大时延。如果没有最大时延，该算法会正确工作吗？
* 会。

---
#### 12. 假设在一个多处理器的同步处理中没有TSL指令。相反，提供了另一个指令SWP，该指令可以吧一个寄存器的内容交换到内存的一个字中。这个指令可以用于多处理器同步吗？如果可以，她应该如何使用？如果不行，为什么他不行。
* 可以用于指定一个值表示上锁，比如说1，0表示未上锁，某一个CPU想使用它，就用自己寄存器中的1跟他交换，如果换回来的是1，就表示已被上锁，就等等，如果换回来的是0，就表示可以使用。

---
#### 13. 在本问题中，读者要计算把一个自旋锁放到总线上需要花费多少装载时间。假设CPU执行每条指令花费5ns。在一条指令执行完毕后，不需要任何总线周期，例如，执行TSL指令。每个总线周期比指令执行时间长10ns甚至更多。如果一个进程使用TSL循环试图进入某个临界区，他要耗费多少的总线带宽？假设通常的高速缓冲处理正在工作，所以取一个循环体重的指令并不会浪费总线周期。
* 10 / 5 + 10 + 5 = 0.5

---
#### 14. 亲和调度减少了高速缓冲的失效。他也减少TLB的失效吗？对于缺页异常呢？
* 他可能会减少TLB失效，因为TLB保存在CPU中，但是不会影响缺页异常，因为页面保存在内存中。

---
#### 15. 对于图8-16中的每种拓扑结构，互联网络的直径是多少？请计算该问题的所有跳数（主机-路由器和路由器-路由器）
* 2
* 4
* 8
* 5
* 3
* 4

---
#### 16. 考虑图8-16 d中的双面拓扑，但是扩展到k*k。该网络的直径是多少？
* 奇数时：k-1
* 偶数时：k

---
#### 17. 互联网络的平分带宽经常用来测试网络容量。其计算方法是，通过移走最小数量的链接，将网络分成两个相等的部分。然后把被移走链接的容量加进去。如果有很多方法进行分割，那么最小带宽就是其平分带宽。对于有一个8x8x8立方体互联网络，如果每个链接带宽是1GB/s那么其平分带宽是多少？
* 64Gb/s

---
#### 18. 如果多计算机系统中的网络接口处于用户模式，那么从源RAM到目的RAM只需要三个副本。假设该网络接口卡接受或发送一个32位的字需要20ns，并且该网络接口卡的频率是1Gb/s。如果忽略掉复制的时间，那么吧一个64字节的包从源送到目的地的延时是多少？如果考虑复制时间呢？接着考虑需要有两次额外复制的情形，即在发送方将数据复制到内核的时间，和在接收方将数据从内核取出的时间。在这种情形下的延时是多少？
* x = (64 * 8 / 10 ^ 9)s = 512ns
* 2 * (64 / 4 * 20)  + 512 = 1152ns
* 1152 + 2 * 320 = 1792ns

---
#### 19. 对于三次复制和五次复制的情形，重复前一个问题，不过这次是计算带宽而不是延时。
* 55.6 MB/s 35.7 MB/s

---
#### 20. 在将数据从RAM传送到网络接口时，可以使用钉住页面的方法，假设钉住和释放页面的系统调用要花费1微妙的时间。使用DMA方法复制速度是5字节1ns，而使用编程I/O的方法需要20ns。一个数据包应该有多大才值得订主页面并使用DMA方法？
* 大概330个字节差不多

---
#### 21. 将一个过程从一台机器中取出并且放到另一台机器上成为RPC，但会出现一些问题。在正文中，我们只出了其中四个：指针，未知数组大小，未知参数类型以及全局变量。有一个为讨论的问题是，如果远程过程执行一个系统调用会怎么样。这样做回引起什么问题？应该怎样处理？
* 会引起错误，远程主机无法自己处理这个错误，需要发回原主机处理。

---
#### 22. 在DSM系统中，当出现一个页面故障时，必须对所需要的页面进行重定位。请列出两种寻找该页面的可能途径。
* 可以发广播寻找
* 维护一个共享的页面数据库

---
#### 23. 考虑图8-24中的处理器分配。假设进程H从节点2被移到节点3上。其实的外部信息流量是多少？
* 35

---
#### 24. 某些多计算机允许把运行着的进程从一个节点迁移到另一个节点。停止一个进程，冻结其内存映像，然后就把他们转移到另一个节点上是否足够？请指出要使所述方法能够工作的两个必须解决的问题。
* 内核中会有很多进程信息，要把这些信息也要迁移。

---
#### 25. 在以太网上为什么会有对电缆长度的限制？
* 信号存在衰减和干扰吧。

---
#### 26. 在图8-27中，四台机器上的第三层和第四层标记为中间件和应用。在何种角度上他们是跨平台一致的，而在何种角度上他们是跨平台有差异的？
* 如果在其上层的应用不直接进行系统调用，那他们就是一致的。
* 如果会跨越中间件对其下层直接进行调用，那就是不一致的。

---
#### 27. 在图8-33中列出了六种不同的服务。对于下面的应用，哪一种更合适？（a）Intenet上的视屏点播（b）下载一个网页。
* 不可靠链接。
* 可靠的字节流

---
#### 28. DNS的名称有一个层次结构，如...维护DNS数据库的一种途径是使用一个集中式的数据库，但是实际上并没有这样做，其原因是每秒终会有太多的请求。请提出一个实用的维护DNS数据库的建议。
* 就像现在实际的这样，分层结构管理。

---
#### 29.在讨论浏览器如何处理URL时，曾经说明与端口80链接，为什么？
* 端口是找指定进程的，80端口是web服务器进程的默认端口。

---
#### 30. 虚拟机迁移可能比进程迁移更容易，但是迁移仍然是困难的。在虚拟机迁移的过程中会产生哪些问题？
* 主要涉及对于迁移时可能要处理的I/O请求。如果没有相关请求，那是可以的。现在很多大型虚拟机上运行的服务程序，每时每刻都有进来的服务请求。

---
#### 31. 当浏览器获取一个网页时，他首先发起一个TCP链接以获得页面上的文本。然后关闭链接并分析该页面。如果页面上有图形或图标，就发起不同的TCP链接以获取他们。请给出两个可以改善性能的建议。
* 服务器在这个网页中包含的所有资源都统一发送。
* 请求这些资源时使用无连接的方法。

---
#### 32. 在使用会话语义时，有一项总是成立的，即一个文件的修改对于进行该修改的进程是立即可见的。而对于其他机器上的进程而言是绝对不可见的。不过存在一个问题，即这种修改对同一台机器上的其它进程是否应该立即可见。请正反双方提供争辩意见。
* 如果立即可见可以避免脏写。
* 如果立即可见会产生大量的总线压力。

---
#### 33. 当有多个进程需要访问数据时，基于对象的访问在哪些方面好于共享存储器？
* 共享内存与整个页面一起使用。这可能导致虚假共享，访问发生在同一页面上的无关变量时会导致颠簸。将每个变量放在单独的页面上是浪费的。基于对象的访问消除了这些问题，并允许更细微的共享。

---
#### 34. 在Linda的in操作完成对于各远足的定位置后，现行的查询整个元组攻坚是非常低效率的，请设计一种组织元祖空间的形式，可以再所有in操作中加快查询操作。
* 采用分级按类型的形式存储，就像索引一样。

---