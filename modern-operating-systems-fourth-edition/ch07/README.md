# 第7章 虚拟化和云

### 习题

---
#### 1. 解释为什么数据中心关心虚拟化技术。
* 为了能够更加充分与灵活的使用分配硬件资源。

---
#### 2. 解释为什么公司会希望在一台已使用了一段时间的机器上运行虚拟机管理程序？
* 因为发现需要添加别的服务器，但是现有的这个机器负载并不是很高。

---
#### 3. 解释为什么软件开发者会在用于开发的台式机上使用虚拟化技术。
* 可以很方便的部署测试运行环境，不用担心害怕崩溃。

---
#### 4. 解释为什么家庭成员对虚拟化技术感兴趣？
* 我周围的家庭成员对虚拟化技术都不感兴趣。
* 倒是对云很感兴趣。
* 硬要说，可能是可以再一台机器的条件下拥有属于自己的操作系统环境吧。

---
#### 5. 你认为虚拟化技术为什么经过很长时间才变得流行起来？毕竟，关键论文写于1974年，而IBM大型机从20世纪70年代就有了必要的软硬件支持。
* 可能那时候网络技术不是很好，算力对于支持多系统还很吃力。

---
#### 6. 列出两类PG意义上的敏感指令。
1. 企图访问或修改虚拟机模式或机器状态的指令。
2. 企图访问或修改敏感寄存器或存储单元，如时钟寄存器、中断寄存器等的指令。 
3. 企图访问存储保护系统或内存、地址分配系统的指令。
4. 所有I/O指令。

---
#### 7. 列出三条PG意义上的非敏感指令。
* 读写用户空间内存
* 普通的计算
* 读寄存器的值

---
#### 8. 全虚拟化和半虚拟化有什么区别？你认为哪个更难实现？解释你的答案。
* 全虚拟化部署在虚拟化层上的操作系统不需要专门配置，但是不能直接操作硬件，效率比不过半虚拟化。
* 半虚拟化要求部署其上的操作系统有特殊配置，或修改代码，好处是可以直接操作硬件效率高，但是部署配置起来非常复杂。
* 可能半虚拟化更难实现，因为要改写操作系统代码，还要更复杂的适配，可能在半虚拟化层相关的代码会简单一些。

---
#### 9. 如果有源代码，半虚拟化一个操作系统可行吗？如果没有源代码呢？
* 如果有源代码应该是可行的，没有的话就不行了。

---
#### 10. 考虑可以同时支持最多n个虚拟机的第一类虚拟机管理程序，由于PC磁盘最多四个主分区，n能大于4吗？如果能，数据如何保存？
* 能，虚拟机可以在真实的磁盘上创建一个文件假装这是一个磁盘分区，然后对这个文件做映射就行了。

---
#### 11. 简要解释进程级虚拟化的概念。
* 只为特定的应用程序提供在某一个不兼容操作系统上的虚拟化兼容平台。

---
#### 12. 为什么会存在第二类虚拟机管理程序？毕竟，没有什么是第二类能做儿第一类不能做的。而且第一类虚拟机管理程序通常更加高效。
* 第一类虚拟机只有专业的操作用户才能使用，而第二类虚拟机普通用户也能很方便的使用。关键是更加面向大众。使用门槛更低。

---
#### 13. 虚拟化对第二类虚拟机管理程序有什么用？
* 虚拟化就是骗，它欺骗在它运行的操作系统以为它下面没有一个宿主操作系统。

---
#### 14. 为什么会出现二进制翻译技术？你认为这种技术有前途吗？
* 为了避免过于频繁的陷入内核操作，让程序运行更加高效。虽然现在处理器厂商都已经陆续开始支持虚拟化技术了，但基于他们的实现有时候性能表现更差。
* 还可以考虑将二进制翻译技术运用到编译器或是汇编器的开发上。

---
#### 15. 解释x86的四个特权级是如何支持虚拟化的。
* 因为原本的操作系统是运行在0级，用户空间在3级，中间还有两级没用，这就给虚拟化提供了操作空间，虚拟化可以将自己放在零级然后将操作系统放在1级，也可以将操作系统放在0级然后自己放在1级，以分别实现第一类虚拟化技术和第二类虚拟化技术。也可以部分操作分别部署在不同等级。

---
#### 16. 为什么基于硬件（支持虚拟化技术的处理器）的虚拟化方法有时候比基于二进制方法的性能更差。陈述一条理由。
* 因为有可能基于硬件实现的虚拟化方法会有大量的陷入并模拟的操作，导致性能下降。通过二进制模拟会降低陷入操作的数量。

---
#### 17. 举一个例子说明在二进制翻译系统中，翻译后的代码可能比原始代码运行更快。
* 它将原本代码中的敏感指令转换成对虚拟化管理程序的操作调用，避免了陷入，提高的运行效率。

---
#### 18. VMware每次二进制翻译一个基本块，执行这个基本块，再翻译下一个。能提前翻译吗？如果能的话，比较两种优缺点。
* 能，增加了并行性，提高了翻译运行速度，就像流水线一样。
* 同样的缺点也像流水线，可能导致不精确的中断。

---
#### 19. 虚拟机管理程序和微内核有什么区别吗？
* 如果一个虚拟机管理程序只运行半虚拟化的操作系统，不需要模拟敏感指令部分，那它跟微内核没什么区别。

---
#### 20. 简要解释为什么现实中难以很好地进行虚拟化？解释你的答案？
* 现实中大多使用x86体系结构的处理器。
* x86的指令集复杂。
* 其外部设备众多。
* x86芯片不可虚拟化

---
#### 21. 在一台电脑上运行多个虚拟机需要大量内存，为什么？你能想到什么减少内存是用的方法吗？解释你的答案。
* 因为要为每个操作系统分配内存空间啊。可以使用虚拟内存，找到其中冗余的内容，使用共享的方法，这样只用保留一个副本。

---
#### 22. 解释内存虚拟化中使用影子页表的概念。
* 就是针对在运行其上的操作系统产生的虚拟内存页表的页表。

---
#### 23. 一种处理客户操作系统使用普通指令修改页表的方法是将页表标记为只读，当页表被修改时陷入。还有什么其他方法可以维护影子页表？比较你的方法与只读页表的效率。
* 不管，可以等到缺页异常后再处理。
* 我的效率更慢，因为会产生大量缺页异常。

---
#### 24. 为什么使用气球驱动程序？这是欺骗吗？
* 底层的封装对上层那怎么能叫骗呢。
* 为了更充分的利用硬件资源。

---
#### 25. 描述一个气球驱动程序不起作用的情况。
* 每一个系统都会经常的请求最大内存。

---
#### 26. 解释内存虚拟化中使用的去重概念。
* 找到内存中冗余的内容，使用共享的方法，这样只用保留一个副本。

---
#### 27. 计算机几十年来一直使用DMA进行I/O，在I/OMMU出现前这在虚拟化中导致了什么问题？
* DMA使用的绝对物理地址来进行I/O操作，在没有I/OMMU时虚拟化管理程序要自己进行合适的地址映射。

---
#### 28. 举出在云上面而不是本地运行程序的一个优点和一个缺点。
* 优点是可以弹性的获得资源，而没有浪费，也不会存在不够的情况。
* 会产生大量的网费。

---
#### 29. 分别举出IAAS，PAAS，SAAS的一个例子。
* 各种云服务器实例。
* 什么亚马逊，天猫淘宝微信公众号。
* 什么office360，石墨文档啥的。

---
#### 30. 为什么虚拟机迁移很重要？这项技术在什么情况下有用？
* 想把服务端迁到性能更好的机器上。更换旧设备。

---
#### 31. 迁移虚拟机可能比迁移进程更容易，但仍然比较困难。迁移虚拟机的过程中会遇到什么困难？
* 迁移过程中需要停机，这对于一些服务提供商就很致命，要竟可能的快速保存当前状态，快速停机并转移恢复。
* 可能在操作上更容易，但是对于时效的要求更高。

---
#### 32. 为什么把虚拟机从一台机器迁移到另一台机器比吧进程从一台机器迁移到另一台机器更容易？
* 因为虚拟机只要吧所有当前内容保存成镜像然后再另一台机器安装即可。
* 进程会有各种当前状态，不精确中断就是个很麻烦的事。要记录当前寄存器状态，程序计数器，虚拟页表，还要将这些分别放到新机器的目标位置，就很费经。

---
#### 33. 虚拟机热迁移和另一种方式（冷迁移）的区别是什么？
* 热迁移可以再操作系统不停止运行的情况下转移。但其实只是停机时间很短不会产生严重影响。

---
#### 34. 设计VMware时考虑的三个主要需求是什么？
* 兼容性
* 性能
* 隔离

---
#### 35. 为什么VMware Workstation刚面世时已有大量的外围设备会是一个问题？
* 因为无法对这大量的外围设备都做虚拟化，

---
#### 36. ESXi体积很小，为什么？毕竟数据中心中的服务器通常数十GB内存，多占用少占用有什么区别？
* 因为他的服务对象也有比较小的设备。

---
#### 37. 通过网络搜索，找到两个现实中的虚拟装置例子。
* ESXi